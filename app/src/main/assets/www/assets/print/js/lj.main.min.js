var RESTSERVICESBASE="http://ef76d7d3e6c0436fa4c6c3b4e753c966.cloudapp.net/MobileService.svc/",SVGBASELOCATION="http://commondatastorage.googleapis.com/svgdocs/",LOGOBASELOCATION="http://commondatastorage.googleapis.com/clientlogos/";
function MainViewModel(){var a=this;a.storageObject={SessionID:0};a.GetPortalParametersUrl=RESTSERVICESBASE+"GetPortalParameters";a.GetMenuDataUrl=RESTSERVICESBASE+"GetMobileMenuData";a.UpdateSessionURL=RESTSERVICESBASE+"UpdateActivityForSessionID";a.GetDataByNameUrl=RESTSERVICESBASE+"GetDestinationByName";a.WalkingMapsUrl=RESTSERVICESBASE+"GetSVGXMLData";a.SendDirectionsUrl=RESTSERVICESBASE+"SendDirections";a.clientVM=new ClientViewModel;a.ljdirectionsVM=new LJDirectionsViewModel;a.toVM=new LocationViewModel("to");
a.fromVM=new LocationViewModel("from");a.lookupVM=new LookupItemViewModel("main");a.lookupVM_selectedSubItem=ko.observable();a.dataVM=new DestinationListViewModel;a.currentPage="home";a.printableVM=new PrintableViewModel;a.isFooterNavBar=ko.observable(!1);a.googleDirectionsVM=new GoogleDirectionsViewModel;a.start_location=ko.observable({name:""}).syncWith("newLocationfrom");a.end_location=ko.observable({name:""}).syncWith("newLocationto");a.campus_visible=ko.observable(!0).syncWith("campusVisible");
a.searchStart_visible=ko.observable(!0).syncWith("searchVisiblefrom");a.searchEnd_visible=ko.observable(!0).syncWith("searchVisibleto");a.pushNextDestination=function(){window.location.href.split("?")[0].split("#");a.end_location().isOffCampus()?window.location.href="index.html#home?address="+encodeURIComponent(a.end_location().QuickLink()):window.location.href="index.html#home?from="+encodeURIComponent(a.end_location().name())};a.emailLegendHtml=ko.observable("Who do you want to email?");a.emailToSendTo=
ko.observable("");a.emailToSendTo.subscribe(function(){a.end_location()&&a.start_location()&&a.end_location().DisplayName&&a.start_location().DisplayName&&a.emailToSendTo().match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/)?$(".mailToStatementButton").addClass("getDirectionsButton"):$(".mailToStatementButton").removeClass("getDirectionsButton")});a.mailToStatement=function(c,d){if(a.end_location()&&a.start_location()&&a.end_location().DisplayName&&a.start_location().DisplayName&&a.emailToSendTo().match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/)){var b;
b=mainVM.start_location().isOffCampus&&!mainVM.start_location().isOffCampus()?3:15;if(d){var f=!mainVM.start_location()?null:"function"==typeof mainVM.start_location().name?mainVM.start_location().name():mainVM.start_location().name,g=!mainVM.end_location()?null:"function"==typeof mainVM.end_location().name?mainVM.end_location().name():mainVM.end_location().name,e=!mainVM.toVM?null:"function"==typeof mainVM.toVM.selectedParkingID?mainVM.toVM.selectedParkingID():mainVM.toVM.selectedParkingID;b=mainVM.SendDirectionsUrl+
"?email="+a.emailToSendTo()+"&host="+window.location.host+"&endDisplayName="+encodeURIComponent(a.end_location().DisplayName())+"&startDisplayName="+encodeURIComponent(a.start_location().DisplayName())+"&parking="+encodeURIComponent(e)+"&printing="+b+"&from="+encodeURIComponent(f)+"&to="+encodeURIComponent(g);$.ajax(b)}else b="mailto:"+encodeURIComponent(a.emailToSendTo())+"?subject="+encodeURIComponent("Directions to "+a.end_location().DisplayName())+"&body="+encodeURIComponent("From: \r\n\t"+a.start_location().DisplayName()+
" \r\nTo: \r\n\t"+a.end_location().DisplayName()+" \r\n \r\nInteractive Directions: \r\n\t"+location.href.replace("my location","my%20location")+" \r\nPrinter Friendly Directions: \r\n\t"+location.href.replace("my location","my%20location").replace(/\#.+\?/,"#printable?printing="+b+"&")+" \r\n"),document.location.href=b;a.emailToSendTo("");$("#emailpopup"+c).popup("close")}else ShowPopupWarningSpan();return!1};a.guideText=ko.observable();a.lookup_breadcrumb=[];a.directionsHref=ko.observable("#walkingdirections");
a.MenuItems=[];a.driveMap=!0;a.DirectionBtnEnabled=ko.observable(!1);a.resetPage=function(){var a=getParameterByName(window.location.href,"host");window.location.href="index.html"+(a?"#home?host="+a:"")};a.printActionClick=function(a){$("#actionMenu"+a).popup("close");$.delayInvoke(function(d){$("#printpopup"+a).popup("open")},50)();return!1};a.sendEmailClick=function(c){a.emailLegendHtml("Who do you want to email?");$("#actionMenu"+c).popup("close");$.delayInvoke(function(a){$("#emailpopup"+c).popup("open")},
50)();return!1};a.isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}};a.changeLocationFrom=
function(){a.fromVM.searchVM.saved_value(a.start_location());a.fromVM.searchVM.saved_name("");a.fromVM.onoff("");$("#searchFieldFrom").val("");$("#searchFieldGoogle").val("");$("#searchFieldGoogleIE8").val("");a.searchStart_visible(!0);a.campus_visible(!0);$("#searchFieldFrom").blur();recreateBindings();PushNewState("",!0)};a.changeLocationTo=function(){a.toVM.searchVM.saved_value(a.end_location());a.toVM.searchVM.saved_name("");a.searchEnd_visible(!0);$("#searchFieldTo").val("");$("#searchFieldTo").focus();
recreateBindings();PushNewState("",!1,!0)};a.DirectionBtnEnabled.subscribe(function(){a.updateGuideInformation()});a.campus_visible.subscribe(function(){a.updateLinkVisibility()});a.searchStart_visible.subscribe(function(){a.updateLinkVisibility()});a.searchEnd_visible.subscribe(function(){a.updateLinkVisibility()});a.scrollToLast=null;a.scrollTo=function(c){a.scrollToLast!=c&&(a.scrollToLast=c,$("html, body").animate({scrollTop:$(c).offset().top-30},500))};a.updateGuideInformation=function(){$("#searchFieldFrom").prop("disabled",
!1);$("#fromLookupButton").prop("disabled",!1);if(!a.searchStart_visible()&&!a.searchEnd_visible())a.DirectionBtnEnabled()&&a.guideText("Your directions are ready!"),a.DirectionBtnEnabled()||a.guideText("Getting Directions..."),a.scrollTo("#home");else if(a.searchStart_visible()&&!a.campus_visible()){a.guideText("Enter your current location.");768>$(window).width()&&"off"!=a.fromVM.onoff()&&$("#searchFieldFrom").focus();var c=$.delayInvoke(function(c){768>$(window).width()&&a.fromVM.onCampusVisible()&&
a.scrollTo("#autocompleteFrom");768>$(window).width()&&a.fromVM.offCampusVisible()&&a.scrollTo("#autocompleteGoogle")},50);c()}else a.searchStart_visible()&&a.campus_visible()?(768>$(window).width()&&a.scrollTo("#home"),a.guideText("Are you at the hospital?"),$("#searchFieldFrom").prop("disabled",!0),$("#fromLookupButton").prop("disabled",!0)):!a.searchStart_visible()&&a.searchEnd_visible()&&(a.guideText("Enter your destination."),768>$(window).width()&&$("#searchFieldTo").focus(),c=$.delayInvoke(function(c){768>
$(window).width()&&a.scrollTo("#searchFieldTo")},50),c())};a.updateDirectionsButton=function(){$("#directionsBtn").hasClass("pageButton")||$("#directionsBtn").addClass("pageButton");$("#directionsBtn").hasClass("dialogButton")&&$("#directionsBtn").removeClass("dialogButton");if(a.start_location().isOffCampus&&!a.start_location().isOffCampus()&&a.end_location().isOffCampus&&!a.end_location().isOffCampus())a.directionsHref("#walkingdirections"),a.DirectionBtnEnabled(!0);else if(a.start_location().isOffCampus&&
!a.start_location().isOffCampus()&&a.end_location().isOffCampus&&a.end_location().isOffCampus()||a.start_location().isOffCampus&&a.start_location().isOffCampus()&&a.end_location().isOffCampus&&!a.end_location().isOffCampus())a.DirectionBtnEnabled(!1),$.when(a.toVM.PopulateParking(a.clientVM.clientID(),a.end_location().isOffCampus()?"ALL":a.end_location().QuickLink())).then(function(){1<a.toVM.parkingTypes().length?($("#directionsBtn").hasClass("pageButton")&&$("#directionsBtn").removeClass("pageButton"),
$("#directionsBtn").hasClass("dialogButton")||$("#directionsBtn").addClass("dialogButton"),a.directionsHref("#popupPrompt")):a.directionsHref("#driving");a.DirectionBtnEnabled(!0)});else if(a.start_location().isOffCampus&&a.start_location().isOffCampus()||a.end_location().isOffCampus&&a.end_location().isOffCampus())a.directionsHref("#driving"),a.DirectionBtnEnabled(!0)};a.updateLinkVisibility=function(){a.updateGuideInformation();a.updateDirectionsButton()};a.itemClicked=function(c){0>jQuery.inArray(c,
a.lookup_breadcrumb)&&a.lookup_breadcrumb.push(a.lookupVM_selectedSubItem());c.hasSubItems()?(a.lookupVM_selectedSubItem(c),$("#lookup").trigger("create"),PushNewState("page=lookup")):(PushNewState("page=data"),a.dataVM.headerText(c.headerText),a.dataVM.StartIndex(0),a.dataVM.Filter(""),a.dataVM.Sorting(""),a.dataVM.ClientDestinationID(c.data_id))};a.backClick=function(c,d){d.performedBackClick||(d.performedBackClick=!0,$.delayInvoke(function(){0<a.lookup_breadcrumb.length?(a.lookupVM_selectedSubItem(a.lookup_breadcrumb.pop()),
$("#lookup").trigger("create"),"data"==$.mobile.activePage.data("url")&&a.cleanData(),"lookup"!=$.mobile.activePage[0].id&&PushNewState("page=lookup")):PushNewState("page=home")},10)())};a.cleanData=function(){};a.SetFromViaUrl=function(c){var d=$.Deferred(),b=getParameterByName(c,"from");b&&"undef"!=b&&(!a.start_location().name||b.toLowerCase()!=a.start_location().name().toLowerCase())?($.support.cors=!0,$.when($.getJSON(a.GetDataByNameUrl+"?DestinationName="+encodeURIComponent(b.replace("#","%23"))+
"&ClientID="+a.clientVM.clientID()+getJsonpSuffix())).then(function(b){b=escapeJSON(b);if(""!=b&&(b=JSON.parse(b),Array.isArray(b)))for(var c=0;c<b.length;c++){var e=new DestinationViewModel([]);e.name(b[c].DestinationText);e.DisplayName(b[c].DisplayName);e.QuickLink(b[c].QuickLink);a.start_location(e);a.campus_visible(!1);a.searchStart_visible(!1);a.fromVM.onoff("on");mainVM.storageObject.fromSearchType||(mainVM.storageObject.fromSearchType="prepop");a.storageObject.StartDestinationName=a.start_location().name()}d.resolve()}).fail(function(c,
d,e){throw"getJSON failed: "+e+" "+a.GetDataByNameUrl+"?DestinationName="+encodeURIComponent(b.replace("#","%23"))+"&ClientID="+a.clientVM.clientID()+getJsonpSuffix();})):!b&&"undef"!=b&&!getParameterByName(c,"address")?(a.campus_visible(!0),a.searchStart_visible(!0),a.fromVM.onoff(""),a.fromVM.searchVM.saved_name(""),a.storageObject.StartDestinationName="",d.resolve()):"undef"!=b&&a.start_location()&&a.start_location().name?(a.campus_visible(!1),a.searchStart_visible(!1),a.storageObject.StartDestinationName=
a.start_location().name(),d.resolve()):"undef"==b&&!getParameterByName(c,"address")?(a.searchStart_visible(!0),a.start_location({name:""}),a.fromVM.onoff("on"),a.fromVM.searchVM.saved_name(""),a.storageObject.StartDestinationName=""):d.resolve();return d.promise()};a.SetToViaUrl=function(c){var d=$.Deferred(),b=getParameterByName(c,"to");b&&(!a.end_location().name||b.toLowerCase()!=a.end_location().name().toLowerCase())?($.support.cors=!0,$.when($.getJSON(a.GetDataByNameUrl+"?DestinationName="+encodeURIComponent(b.replace("#",
"%23"))+"&ClientID="+a.clientVM.clientID()+getJsonpSuffix())).then(function(b){b=escapeJSON(b);if(""!=b&&(b=JSON.parse(b),Array.isArray(b)))for(var c=0;c<b.length;c++){var e=new DestinationViewModel([]);e.name(b[c].DestinationText);e.DisplayName(b[c].DisplayName);e.QuickLink(b[c].QuickLink);a.end_location(e);a.searchEnd_visible(!1);mainVM.storageObject.toSearchType||(mainVM.storageObject.toSearchType="prepop");a.storageObject.EndDestinationName=e.name()}d.resolve()}).fail(function(c,d,e){throw"getJSON failed: "+
e+" "+a.GetDataByNameUrl+"?DestinationName="+encodeURIComponent(b.replace("#","%23"))+"&ClientID="+a.clientVM.clientID()+getJsonpSuffix();})):(b?a.end_location().name&&(a.searchEnd_visible(!1),a.storageObject.EndDestinationName=a.end_location().name()):(a.searchEnd_visible(!0),a.toVM.searchVM.saved_name(""),a.storageObject.EndDestinationName=""),d.resolve());return d.promise()}}function escapeJSON(a){return a.replace(/\r?\n/g,"")}
function getImageDataURL(a,c,d){var b,f,g,e=new Image;e.onload=function(){f=document.createElement("canvas");f.width=e.width;f.height=e.height;g=f.getContext("2d");g.drawImage(e,0,0);try{b=f.toDataURL(),c({image:e,data:b})}catch(a){d(a)}};try{e.src=a}catch(h){d(h)}}function PushNewState(a,c,d,b,f){a=getNewURL(a,c,d);window.location.hash!=a&&$.mobile.navigate(a,b?b:null)}
function getNewURL(a,c,d){var b=a.toLowerCase(),f=!1,g=!1,e=!1;-1<b.indexOf("from")&&(g=!0);-1<b.indexOf("address")&&(f=!0);c&&(g=f=!0);d&&(e=!0);c=window.location.href.split(/[\\?#]+/)[0];if("CLEAR"==a)return c.replace("#","");window.location.href.split(/[\\?#]+/)[window.location.href.split(/[\\?#]+/).length-1].split("#");if(window.location.href.split(/[\\?#]+/)[1]){a=window.location.href.split(/[\\?#&]+/);for(c=0;c<a.length;c++)0>b.indexOf(a[c].split("=")[0].toLowerCase()+"=")&&"_suid"!=a[c].split("=")[0].toLowerCase()&&
(!(g&&"address"==a[c].split("=")[0].toLowerCase())&&!(f&&"from"==a[c].split("=")[0].toLowerCase())&&!(e&&"to"==a[c].split("=")[0].toLowerCase())&&a[c].split("=")[1])&&(0<b.length&&(b+="&"),b+=a[c].split("=")[0]+"="+a[c].split("=")[1])}0==b.indexOf("page=")?b="#"+b.substring(5).replace("&","?"):0<b.indexOf("&page=")?(f=b.split("&page=")[0],b=b.split("&page=")[1],g="",-1<b.indexOf("&")?(g=b.split("&")[0],b=b.substring(g.length)):(g=b,b=""),b="#"+(g||"home")+"?"+f+b):window.location.href.match(/#([^=]+)[\\?]/)?
(g=window.location.href.match(/#([^=]+)[\\?]/)[1],b="#"+g+"?"+b):b="#home?"+b;b=b.replace(/#$/,"");f=!mainVM.start_location()?null:"function"==typeof mainVM.start_location().name?mainVM.start_location().name():mainVM.start_location().name;g=!mainVM.end_location()?null:"function"==typeof mainVM.end_location().name?mainVM.end_location().name():mainVM.end_location().name;e=!mainVM.toVM?null:"function"==typeof mainVM.toVM.selectedParkingID?mainVM.toVM.selectedParkingID():mainVM.toVM.selectedParkingID;
if("#home"!=b&&-1==b.indexOf("?")&&(f||g||e))e&&(b+=(-1==b.indexOf("?")?"?":"&")+"parking="+encodeURIComponent(e)),f&&(b+=(-1==b.indexOf("?")?"?":"&")+"from="+encodeURIComponent(f)),g&&(b+=(-1==b.indexOf("?")?"?":"&")+"to="+encodeURIComponent(g));return b}function recreateBindings(){}var mainVM=new MainViewModel,SUPPORTS_SVG=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");
function getParameterByName(a,c){var d="";"page"==c&&-1==a.indexOf("page=")?d="[\\?#]([^\\?&#]*)":(c=c.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),d="[\\?&#]"+c+"=([^&#]*)");d=RegExp(d).exec(a.toLowerCase());return null==d||"page"==c&&-1<d[1].indexOf("=")?"":decodeURIComponent(d[1].replace(/\+/g," "))}$(window).resize(function(){mainVM.clientVM.setLogoImage();setNavBar();mainVM.ljdirectionsVM.resizeSVG()});
function setNavBar(){768>$(window).width()?mainVM.isFooterNavBar(!0):mainVM.isFooterNavBar(!1)}
window.onload=function(){mainVM||(mainVM=new MainViewModel);mainVM.cleanData();checkRefresh();mainVM.storageObject.loadTime||(mainVM.storageObject.loadTime=(new Date).getTime());mainVM.googleDirectionsVM.initializeGoogleMap(mainVM.clientVM.mainLatLng,mainVM.clientVM.mainLatLng);ko.applyBindings(mainVM,document.getElementById("mainBody"));mainVM.clientVM.LoadPortalParameters(function(){mainVM.clientVM.setLogoImage();setNavBar();PopulateLookup();getViewState()})};
function getViewState(a){var c=a?a:getParameterByName(window.location.href,"page");!c&&($.mobile.activePage&&0<$.mobile.activePage.length)&&(c=$.mobile.activePage[0].id);c||(c="home");if(mainVM.currentPage!=c){if(mainVM.currentPage=c,PushNewState("page="+c),recreateBindings(),mainVM.searchStart_visible(!0),mainVM.searchEnd_visible(!0),"driving"===c||"drivingdirections"===c||"walking"===c||"walkingdirections"===c||"home"===c||"printable"===c)mainVM.clientVM.setLogoImage(),$.when(mainVM.fromVM.googleVM.GetLocationViaUrl(window.location.href),
mainVM.SetFromViaUrl(window.location.href),mainVM.SetToViaUrl(window.location.href)).then(function(a,b,f){mainVM.updateLinkVisibility();if("driving"===c||"drivingdirections"===c||"walking"===c||"walkingdirections"===c||"printable"===c)!1===mainVM.searchStart_visible()&&!1===mainVM.searchEnd_visible()?DrawDirections():PushNewState("page=home"),(a=parseInt(getParameterByName(window.location.href,"printing")))&&mainVM.printableVM.setPrinting(a);$("div.loadingCover").addClass("hide")})}else"home"==c&&
$.when(mainVM.fromVM.googleVM.GetLocationViaUrl(window.location.href),mainVM.SetFromViaUrl(window.location.href),mainVM.SetToViaUrl(window.location.href)).then(function(a,b,c,g){mainVM.updateLinkVisibility();$("div.loadingCover").addClass("hide")})}
function DrawDirections(){if(mainVM.start_location().isOffCampus&&mainVM.start_location().isOffCampus()&&mainVM.end_location().isOffCampus&&!mainVM.end_location().isOffCampus()){var a=getParameterByName(window.location.href,"parking");a||(a=1);a?$.when(mainVM.toVM.GetSelectedParking(mainVM.clientVM.clientID(),a,mainVM.end_location())).then(function(a){mainVM.toVM.selectedParking&&(navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?(mainVM.googleDirectionsVM.urlBase="http://maps.apple.com/maps?saddr=[START LOCATION]&daddr=[END LOCATION]",
"my location"==mainVM.start_location().name().toLowerCase()?mainVM.googleDirectionsVM.url(mainVM.googleDirectionsVM.urlBase.replace("[START LOCATION]",mainVM.start_location().QuickLink().lat()+","+mainVM.start_location().QuickLink().lng()).replace("[END LOCATION]",mainVM.toVM.selectedParking.Latitude+","+mainVM.toVM.selectedParking.Longitude)):mainVM.googleDirectionsVM.url(mainVM.googleDirectionsVM.urlBase.replace("[START LOCATION]",mainVM.start_location().name()).replace("[END LOCATION]",mainVM.toVM.selectedParking.Latitude+
","+mainVM.toVM.selectedParking.Longitude))):(mainVM.googleDirectionsVM.urlBase="http://maps.google.com/maps?saddr=[START LOCATION]&daddr=[END LOCATION]",mainVM.googleDirectionsVM.url(mainVM.googleDirectionsVM.urlBase.replace("[START LOCATION]",mainVM.start_location().name()).replace("[END LOCATION]",mainVM.toVM.selectedParking.Latitude+","+mainVM.toVM.selectedParking.Longitude))),$.when(mainVM.googleDirectionsVM.getDirections(mainVM.start_location().QuickLink(),new google.maps.LatLng(mainVM.toVM.selectedParking.Latitude,
mainVM.toVM.selectedParking.Longitude))).then(function(a){var b=mainVM.toVM.selectedParking?mainVM.toVM.selectedParking.ID:1;$.when(mainVM.ljdirectionsVM.updateLink(mainVM.clientVM.clientID(),0,mainVM.end_location().QuickLink(),b)).then(function(){mainVM.ljdirectionsVM.updateWalkingDirections(mainVM.clientVM.clientID(),0,mainVM.end_location().QuickLink(),b)})}).fail(function(){alert("failed getting directions")}))}).fail(function(){PushNewState("page=home")}):PushNewState("page=home")}else mainVM.start_location().isOffCampus&&
!mainVM.start_location().isOffCampus()&&mainVM.end_location().isOffCampus&&mainVM.end_location().isOffCampus()?((a=getParameterByName(window.location.href,"parking"))||(a=1),a?$.when(mainVM.toVM.GetSelectedParking(mainVM.clientVM.clientID(),a,mainVM.end_location())).then(function(a){mainVM.toVM.selectedParking&&(navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?mainVM.googleDirectionsVM.urlBase="http://maps.apple.com/maps?saddr=[START LOCATION]&daddr=[END LOCATION]":mainVM.googleDirectionsVM.urlBase=
"http://maps.google.com/maps?saddr=[START LOCATION]&daddr=[END LOCATION]",mainVM.googleDirectionsVM.url(mainVM.googleDirectionsVM.urlBase.replace("[END LOCATION]",mainVM.end_location().QuickLink()).replace("[START LOCATION]",mainVM.toVM.selectedParking.Latitude+","+mainVM.toVM.selectedParking.Longitude)),$.when(mainVM.googleDirectionsVM.getDirections(new google.maps.LatLng(mainVM.toVM.selectedParking.Latitude,mainVM.toVM.selectedParking.Longitude),mainVM.end_location().QuickLink())).then(function(a){var b=
mainVM.toVM.selectedParking?mainVM.toVM.selectedParking.ID:1;$.when(mainVM.ljdirectionsVM.updateLink(mainVM.clientVM.clientID(),mainVM.start_location().QuickLink(),0,b)).then(function(){mainVM.ljdirectionsVM.updateWalkingDirections(mainVM.clientVM.clientID(),mainVM.start_location().QuickLink(),0,b)})}).fail(function(){alert("failed getting directions")}))}).fail(function(){PushNewState("page=home")}):PushNewState("page=home")):mainVM.start_location().isOffCampus&&mainVM.start_location().isOffCampus()&&
mainVM.end_location().isOffCampus&&mainVM.end_location().isOffCampus()?(navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?(mainVM.googleDirectionsVM.urlBase="http://maps.apple.com/maps?saddr=[START LOCATION]&daddr=[END LOCATION]","my location"==mainVM.start_location().name().toLowerCase()?mainVM.googleDirectionsVM.url(mainVM.googleDirectionsVM.urlBase.replace("[END LOCATION]",mainVM.end_location().QuickLink()).replace("[START LOCATION]",mainVM.start_location().QuickLink().lat()+","+mainVM.start_location().QuickLink().lng())):
mainVM.googleDirectionsVM.url(mainVM.googleDirectionsVM.urlBase.replace("[END LOCATION]",mainVM.end_location().QuickLink()).replace("[START LOCATION]",mainVM.start_location().name()))):(mainVM.googleDirectionsVM.urlBase="http://maps.google.com/maps?saddr=[START LOCATION]&daddr=[END LOCATION]",mainVM.googleDirectionsVM.url(mainVM.googleDirectionsVM.urlBase.replace("[END LOCATION]",mainVM.end_location().QuickLink()).replace("[START LOCATION]",mainVM.start_location().name()))),mainVM.googleDirectionsVM.getDirections(mainVM.start_location().QuickLink(),
mainVM.end_location().QuickLink())):$.when(mainVM.ljdirectionsVM.updateLink(mainVM.clientVM.clientID(),mainVM.start_location().QuickLink(),mainVM.end_location().QuickLink(),0)).then(function(){mainVM.ljdirectionsVM.updateWalkingDirections(mainVM.clientVM.clientID(),mainVM.start_location().QuickLink(),mainVM.end_location().QuickLink(),0)})}
function PopulateLookup(){$.support.cors=!0;$.when($.getJSON(mainVM.GetMenuDataUrl+"?ClientID="+mainVM.clientVM.clientID()+getJsonpSuffix())).then(function(a){a=escapeJSON(a);a=JSON.parse(a);if(Array.isArray(a))for(var c=0;c<a.length;c++){var d;d=""==a[c].ParentID?mainVM.lookupVM:FindParent(a[c].ParentID,mainVM.lookupVM);var b=new LookupItemViewModel(a[c].ActionID);b.headerText=a[c].MenuLabel.replace("&amp;","&");b.data_id=a[c].OnClick;b.ID=a[c].ID;null!=d&&d.subItems.push(b)}mainVM.lookupVM.mainHeaderText("PlaceHolder")}).fail(function(a,
c,d){throw"getJSON failed: "+d+" "+mainVM.GetMenuDataUrl+"?ClientID="+mainVM.clientVM.clientID()+getJsonpSuffix();})}function ResetLookup(a){mainVM.lookup_breadcrumb=[];mainVM.dataVM.lookup_reference=a;mainVM.lookupVM_selectedSubItem(mainVM.lookupVM);$.delayInvoke(function(a){$("#lookup").trigger("create")},100)();"to"==a?mainVM.lookupVM.mainHeaderText("Select Destination"):mainVM.lookupVM.mainHeaderText("")}
function focusFrom(){$.delayInvoke(function(a){mainVM.fromVM.searchVM.PopulateSuggestions(mainVM.fromVM.searchVM.saved_name());mainVM.fromVM.searchVM.results_visible(!0)},0)()}function blurFrom(a){cancelFromBlur?cancelFromBlur=!1:$.delayInvoke(function(a){mainVM.fromVM.searchVM.saved_name()&&(!mainVM.fromVM.searchVM.saved_value()||!mainVM.fromVM.searchVM.saved_value().name)&&mainVM.fromVM.searchVM.selectCurrentResult();mainVM.fromVM.searchVM.results_visible(!1)},0)()}
var cancelFromBlur=!1,cancelToBlur=!1,cancelGoogleBlur=!1;function focusTo(){$.delayInvoke(function(a){mainVM.toVM.searchVM.PopulateSuggestions(mainVM.toVM.searchVM.saved_name());mainVM.toVM.searchVM.results_visible(!0)},0)()}
function blurTo(){cancelToBlur?cancelToBlur=!1:$.delayInvoke(function(a){mainVM.toVM.searchVM.saved_name()&&(!mainVM.toVM.searchVM.saved_value()||!mainVM.toVM.searchVM.saved_value().name)&&mainVM.toVM.searchVM.selectCurrentResult();mainVM.toVM.searchVM.results_visible(!1)},0)()}function focusGoogle(){$.delayInvoke(function(a){mainVM.fromVM.googleVM.results_visible(!0)},0)()}
function blurGoogle(){cancelGoogleBlur?cancelGoogleBlur=!1:$.delayInvoke(function(a){mainVM.toVM.searchVM.saved_name()&&(!mainVM.toVM.searchVM.saved_value()||!mainVM.toVM.searchVM.saved_value().name)&&mainVM.fromVM.googleVM.changeSavedValue(mainVM.fromVM.googleVM.currentSelectedResult().toString());mainVM.fromVM.googleVM.results_visible(!1)},0)()}
function toKeyUp(a){13==a.keyCode?mainVM.toVM.searchVM.selectCurrentResult():40==a.keyCode?mainVM.toVM.searchVM.increaseCurrentResult():38==a.keyCode?mainVM.toVM.searchVM.decreaseCurrentResult():(mainVM.toVM.searchVM.currentSelectedResult(0),mainVM.toVM.searchVM.saved_name($("#searchFieldTo").val()))}
function fromKeyUp(a){13==a.keyCode?mainVM.fromVM.searchVM.selectCurrentResult():40==a.keyCode?mainVM.fromVM.searchVM.increaseCurrentResult():38==a.keyCode?mainVM.fromVM.searchVM.decreaseCurrentResult():(mainVM.fromVM.searchVM.currentSelectedResult(0),mainVM.fromVM.searchVM.saved_name($("#searchFieldFrom").val()))}var clearAutocomplete;
$(document).on("pageinit",function(){$("#googleSearchDiv .ui-input-clear").on("click",function(a){$.delayInvoke(function(a){mainVM.fromVM.googleVM.resultsList.removeAll();mainVM.fromVM.googleVM.results_visible(!1)},10)()});$("#toSearchDiv .ui-input-clear").on("click",function(a){$.delayInvoke(function(a){mainVM.toVM.searchVM.saved_name("")},10)()});$("#fromSearchDiv .ui-input-clear").on("click",function(a){$.delayInvoke(function(a){mainVM.fromVM.searchVM.saved_name("")},10)()});$(".printpopup").on("popupafteropen",
function(a,c){$.delayInvoke(function(a){try{$(".driveMap").checkboxradio(),$(".driveMap").checkboxradio("refresh")}catch(b){}try{$(".driveDir").checkboxradio(),$(".driveDir").checkboxradio("refresh")}catch(c){}try{$(".walkMap").checkboxradio(),$(".walkMap").checkboxradio("refresh")}catch(g){}try{$(".walkDir").checkboxradio(),$(".walkDir").checkboxradio("refresh")}catch(e){}},0)()});$("#destination-list-table-popup").popup({history:!1});$(window).on("navigate",function(a,c){getViewState()});$("#data table.ui-table tbody tr").on("click",
function(){$($(this).find("a")[0]).click()});$(".pageButton").on("click",function(a){if($(this).hasClass("pageButton")){a.preventDefault();if("printable"==$(this).attr("href").replace("#","")){$(this).hasClass("summaryButton")&&(mainVM.start_location().isOffCampus&&!mainVM.start_location().isOffCampus()?(PushNewState("page=printable&printing=3"),mainVM.printableVM.setPrinting(3)):(PushNewState("page=printable&printing=15"),mainVM.printableVM.setPrinting(15)),mainVM.storageObject.isPrinted=0);if(!mainVM.printableVM.isPrintEnabled())return ShowPopupWarningSpan(),
!1;$(this).hasClass("printButton")&&(PushNewState("page=printable&printing="+mainVM.printableVM.PrintingValue()),mainVM.storageObject.isPrinted=1);$.delayInvoke(function(a){mainVM.printableVM.updateWalkingDivs()},0)()}if("continueBtn"==$(this).attr("id")||"directionsBtn"==$(this).attr("id"))if(0<mainVM.toVM.selectedParkingID()||"directionsBtn"==$(this).attr("id"))mainVM.storageObject.directionsTime||(mainVM.storageObject.directionsTime=(new Date).getTime()),PushNewState("parking="+mainVM.toVM.selectedParkingID()),
getViewState($(this).attr("href").replace("#",""));else if("continueBtn"==$(this).attr("id"))return $(".popupWarningSpan").addClass("show"),$(".popupWarningSpan").css("opacity","1"),$(".popupWarningSpan").stop().animate({opacity:0.001},5E3,function(){$(".popupWarningSpan").removeClass("show");$(".popupWarningSpan").css("opacity","0")}),!1;$.mobile.activePage[0].id!=$(this).attr("href").replace("#","")&&PushNewState("page="+$(this).attr("href").replace("#",""));mainVM.storageObject.SessionID&&$.ajax(mainVM.UpdateSessionURL+
"?SessionID="+mainVM.storageObject.SessionID+(void 0!=mainVM.storageObject.isPrinted?"&isPrinted="+mainVM.storageObject.isPrinted:""))}})});function ShowPopupWarningSpan(){$(".popupWarningSpan").addClass("show");$(".popupWarningSpan").css("opacity","1");$(".popupWarningSpan").stop().animate({opacity:0.001},5E3,function(){$(".popupWarningSpan").removeClass("show");$(".popupWarningSpan").css("opacity","0")})}
$(document).bind("pagechange",function(a,c){"walking"==c.toPage[0].id&&mainVM.ljdirectionsVM.resizeSVG();mainVM.clientVM.clientID()&&getViewState();var d=c.toPage[0].id;if(("driving"===d||"drivingdirections"===d)&&null!==mainVM.googleDirectionsVM.map)google.maps.event.addListenerOnce(mainVM.googleDirectionsVM.map,"resize",function(){mainVM.googleDirectionsVM.googleMapBounds&&mainVM.googleDirectionsVM.map.fitBounds(mainVM.googleDirectionsVM.googleMapBounds)}),google.maps.event.trigger(mainVM.googleDirectionsVM.map,
"resize")});var refresh_prepare=1;
function checkRefresh(){for(var a=(new Date).getUTCSeconds(),c=document.cookie.split("; "),d=0;d<c.length;d++){var b=c[d].split("=");if("SHTS"==b[0].toString())var f=parseInt(b[1]);else if("SHTSP"==b[0].toString())var g=b[1]}if(g&&f&&g==escape(location.href)&&5>Math.abs(a-f)){for(d=0;d<c.length;d++)b=c[d].split("="),mainVM.storageObject[b[0].toString()]="undefined"==b[1]||"null"==b[1]?null:b[1];mainVM.storageObject.isRefresh=!0;mainVM.storageObject.SessionID&&$.ajax(mainVM.UpdateSessionURL+"?SessionID="+
mainVM.storageObject.SessionID)}else mainVM.storageObject.isRefresh=!1}
function prepareForRefresh(){if(0<refresh_prepare){var a=(new Date).getUTCSeconds();document.cookie="SHTS="+a;document.cookie="SHTSP="+escape(location.href);document.cookie="loadTime="+mainVM.storageObject.loadTime;document.cookie="toSearchType="+mainVM.storageObject.toSearchType;document.cookie="fromSearchType="+mainVM.storageObject.fromSearchType;document.cookie="directionsTime="+mainVM.storageObject.directionsTime;document.cookie="SessionID="+mainVM.storageObject.SessionID;document.cookie="StartDestinationName="+
mainVM.storageObject.StartDestinationName;document.cookie="EndDestinationName="+mainVM.storageObject.EndDestinationName}else document.cookie="SHTS=",document.cookie="SHTSP=",document.cookie="toSearchType=",document.cookie="fromSearchType=",document.cookie="directionsTime=",document.cookie="SessionID=0",document.cookie="StartDestinationName=",document.cookie="EndDestinationName="}
function importNode(a,c){if(a)switch(a.nodeType){case document.ELEMENT_NODE:var d=document.createElementNS(a.namespaceURI,a.nodeName);if(a.attributes&&0<a.attributes.length)for(var b=0,f=a.attributes.length;b<f;b++)d.setAttribute(a.attributes[b].nodeName,a.getAttribute(a.attributes[b].nodeName));if(c&&a.childNodes&&0<a.childNodes.length){b=0;for(f=a.childNodes.length;b<f;b++)d.appendChild(importNode(a.childNodes[b],c))}return d;case document.TEXT_NODE:case document.CDATA_SECTION_NODE:case document.COMMENT_NODE:return document.createTextNode(a.nodeValue)}}
;
//@ sourceMappingURL=lj.main.min.js.map
