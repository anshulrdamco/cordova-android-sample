function GoogleDirectionsViewModel(){var a=this;a.map=null;a.errorMessage=ko.observable();a.urlBase="http://maps.google.com/maps?saddr=[START LOCATION]&daddr=[END LOCATION]";a.url=ko.observable();a.directionsHTML=null;a.staticUrl=ko.observable().syncWith("staticUrl");a.startinglocationlatlng=ko.observable();a.endinglocationlatlng=ko.observable();a.googleMapBounds=null;a.encodedPath=null;a.directionsRenderer=new google.maps.DirectionsRenderer;a.directionsRenderer2=new google.maps.DirectionsRenderer;
a.staticDimensions=function(){var a=0,a=0.86*$(window).width()/2,a=Math.round(315<a?315:a);return a+"x150"};google.maps.event.addListener(a.directionsRenderer,"directions_changed",function(){a.directionsHTML=document.getElementById("directionsPanel").innerHTML});a.initializeGoogleMap=function(b,c){var e=new $.Deferred;a.startinglocationlatlng(b);a.endinglocationlatlng(c);if(null===a.map){var d={center:b,zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP},g=document.getElementById("map_canvas");a.map=
new google.maps.Map(g,d)}e.resolve();return e.promise()};a.getDirections=function(b,c){var e=new $.Deferred;$.when(a.initializeGoogleMap(b,c)).then(function(){a.directionsRenderer.setMap(null);a.directionsRenderer.setMap(a.map);a.directionsRenderer2.setMap(null);var c=document.getElementById("directionsPanel");$(c).empty();a.directionsRenderer2.setPanel(document.getElementById("mapsDirections"));a.directionsRenderer.setPanel(c);var c=new google.maps.DirectionsService,b={origin:a.startinglocationlatlng(),
destination:a.endinglocationlatlng(),travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:google.maps.DirectionsUnitSystem.IMPERIAL};c.route(b,function(c,b){b==google.maps.DirectionsStatus.OK?(a.encodedPath=c.routes[0].overview_polyline.points.replace(/\\/g,"\\\\"),a.directionsRenderer.setDirections(c),a.directionsRenderer2.setDirections(c),a.staticUrl("http://maps.googleapis.com/maps/api/staticmap?markers=color:red%7clabel:A%7c"+c.routes[0].legs[0].start_location.lat()+","+c.routes[0].legs[0].start_location.lng()+
"&markers=color:red%7clabel:B%7c"+c.routes[0].legs[0].end_location.lat()+","+c.routes[0].legs[0].end_location.lng()+"&sensor=false&size="+a.staticDimensions()+"&scale=2&path=enc:"+c.routes[0].overview_polyline.points),a.googleMapBounds=c.routes[0].bounds,a.map.setCenter(a.googleMapBounds.getCenter()),a.errorMessage(""),e.resolve()):(a.errorMessage("Error: "+b),e.reject())})}).fail(function(){e.reject()});return e.promise()}}
function GoogleMapsViewModel(){var a=this;a.isTracking=!1;a.start_location=ko.observable().syncWith("newLocationfrom");a.searchStart_visible=ko.observable().syncWith("searchVisiblefrom");a.lastAddress="";a.resultsList=ko.observableArray();a.autocompleteService=new google.maps.places.AutocompleteService;a.currentSelectedResult=ko.observable(0);a.increaseCurrentResult=function(){a.currentSelectedResult(a.currentSelectedResult()+1);a.currentSelectedResult()>=a.resultsList().length&&a.currentSelectedResult(a.resultsList().length-
1)};a.decreaseCurrentResult=function(){a.currentSelectedResult(a.currentSelectedResult()-1);0>a.currentSelectedResult()&&a.currentSelectedResult(0)};a.results_visible=ko.observable(!1);a.refreshList=function(){$.delayInvoke(function(a){try{$("#suggestGoogle").listview("refresh")}catch(c){}},0)()};a.results_visible.subscribe(function(b){a.refreshList()});a.listHTML=ko.computed(function(){var b="";if(!a.results_visible())return b;for(var c=0;c<a.resultsList().length;c++)0==c&&(b+='<li data-role="list-divider" class="ui-li ui-li-divider ui-bar-b"><div class="resultsList">Address Results</div><div class="googlePowered"><img src="images/powered-by-google/desktop/powered-by-google-on-non-white.png"/></div><div class="clear"></div></li>'),
b=$("html").hasClass("lte8")?b+("<li onmousedown=\"mainVM.fromVM.googleVM.changeSavedValue('"+c+'\')" class="'+(c==a.currentSelectedResult()?"ui-btn-hover-a ui-btn ui-btn-up-a ui-btn-icon-right ui-li-has-arrow ui-li":"ui-btn ui-btn-up-a ui-btn-icon-right ui-li-has-arrow ui-li")+'"><div class="ui-btn-inner ui-li"><div class="ui-btn-text"><a class="ui-link-inherit" href=\'#\'>'+a.resultsList()[c].description+"</a></div></div></li>"):b+("<li onmousedown=\"mainVM.fromVM.googleVM.changeSavedValue('"+c+
'\')" class="'+(c==a.currentSelectedResult()?"ui-btn-hover-a":"")+"\"><a href='#'>"+a.resultsList()[c].description+"</a></li>");a.refreshList();return b});a.updateAutocomplete=function(b){""!=b&&null!=b&&a.results_visible(!0);a.currentSelectedResult(0);a.autocompleteService.getPlacePredictions({input:b,radius:3E4,location:mainVM.clientVM.mainLatLng},function(c,b){a.resultsList.removeAll();if(b==google.maps.places.PlacesServiceStatus.OK)for(var d=0;d<c.length;d++)a.resultsList.push(c[d])})};a.changeSavedValue=
function(b){b=a.resultsList()[b];(new google.maps.places.PlacesService(document.getElementById("hiddenfield"))).getDetails(b,function(a,b){if(b==google.maps.places.PlacesServiceStatus.OK){var d=[];d["1"]=a.formatted_address;var g=new DestinationViewModel(d);g.isGoogle=!0;g.name(d["1"]);for(var d="",k,f=0;f<a.address_components.length;f++)if("street_number"==a.address_components[f].types[0]&&(d+=a.address_components[f].short_name+" "),"route"==a.address_components[f].types[0]&&(d+=a.address_components[f].short_name),
"locality"==a.address_components[f].types[0]||"administrative_area_level_3"==a.address_components[f].types[0])k=a.address_components[f].short_name;g.DisplayName((d?d:"")+(d&&k&&k!=d?", ":"")+(k&&k!=d?k:""));g.QuickLink(a.geometry.location);mainVM.fromVM.googleVM.start_location(g);mainVM.fromVM.googleVM.searchStart_visible(!1);mainVM.fromVM.campus_visible(!1);mainVM.storageObject.fromSearchType="google";mainVM.storageObject.StartDestinationName=mainVM.start_location().name();g=a.formatted_address;
mainVM.fromVM.googleVM.lastAddress=g;PushNewState("address="+encodeURIComponent(g.replace("#","%23")))}})};a.loadGL=function(){try{gl="undefined"===typeof navigator.geolocation?google.gears.factory.create("beta.geolocation"):navigator.geolocation}catch(a){}return"undefined"!=typeof gl&&gl};a.useMyLocation=function(){if(a.loadGL()){if(!a.isTracking&&(!a.start_location()||!a.start_location().timestamp||1E5<new Date-a.start_location().timestamp))a.isTracking=!0,gl.getCurrentPosition(a.displayPosition,
a.displayError),mainVM.storageObject.fromSearchType="google"}else alert("Geolocation services are not supported by your web browser.")};a.displayPosition=function(b){var c=new DestinationViewModel([]);c.name("My Location");c.DisplayName("My Location");c.QuickLink(new google.maps.LatLng(b.coords.latitude,b.coords.longitude));c.isGoogle=!0;a.start_location(c);a.searchStart_visible(!1);mainVM.fromVM.campus_visible(!1);mainVM.fromVM.onoff("off");mainVM.storageObject.StartDestinationName=a.start_location().name();
PushNewState("address=My Location");a.isTracking=!1};a.displayError=function(b){alert("Could not get your location: error "+b.code);a.isTracking=!1};a.GetLocationViaUrl=function(b){var c=$.Deferred();if(a.gettingAddress)return c.resolve(),c.promise();a.gettingAddress=!0;var e=getParameterByName(b,"address"),d=getParameterByName(b,"from");""==e&&"my location"==d&&(e=d);if(e&&"undef"!=e&&(a.lastAddress.toLowerCase()!=e.toLowerCase()||!a.start_location()))if("my location"==e.toLowerCase())if(a.loadGL()){if(!a.isTracking&&
(!a.start_location()||!a.start_location().timestamp||1E5<new Date-a.start_location().timestamp))a.isTracking=!0,gl.getCurrentPosition(function(b){a.displayPosition(b);a.lastAddress=e;mainVM.storageObject.fromSearchType||mainVM.storageObject.fromSearchType;a.gettingAddress=!1;c.resolve()},function(b){a.displayError(b);a.gettingAddress=!1;c.reject()},{timeout:5E4})}else alert("Geolocation services are not supported by your web browser.");else(geocoder=new google.maps.Geocoder)&&geocoder.geocode({address:e},
function(b){$("#searchFieldGoogle").val(b[0].formatted_address);$("#searchFieldGoogleIE8").val(b[0].formatted_address);a.lastAddress=e;var d=new DestinationViewModel([]);d.name(b[0].formatted_address);for(var f="",l,h=0;h<b[0].address_components.length;h++)if("street_number"==b[0].address_components[h].types[0]&&(f+=b[0].address_components[h].short_name+" "),"route"==b[0].address_components[h].types[0]&&(f+=b[0].address_components[h].short_name),"locality"==b[0].address_components[h].types[0]||"administrative_area_level_3"==
b[0].address_components[h].types[0])l=b[0].address_components[h].short_name;d.DisplayName((f?f:"")+(f&&l&&l!=f?", ":"")+(l&&l!=f?l:""));d.QuickLink(b[0].geometry.location);d.isGoogle=!0;a.start_location(d);mainVM.fromVM.campus_visible(!1);a.searchStart_visible(!1);mainVM.fromVM.onoff("off");mainVM.storageObject.fromSearchType||(mainVM.storageObject.fromSearchType="prepop");mainVM.storageObject.StartDestinationName=a.start_location().name();a.gettingAddress=!1;c.resolve()},function(b){alert("error");
a.gettingAddress=!1;c.reject()});else!e&&"undef"!=e&&!getParameterByName(b,"from")?(mainVM.fromVM.campus_visible(!0),a.searchStart_visible(!0),mainVM.fromVM.searchVM.saved_name(""),$("#searchFieldGoogle").val(""),$("#searchFieldGoogleIE8").val(""),mainVM.fromVM.onoff(""),mainVM.storageObject.StartDestinationName=""):"undef"!=e&&a.start_location()&&a.start_location().name?(a.searchStart_visible(!1),mainVM.storageObject.StartDestinationName="function"==typeof a.start_location().name?a.start_location().name():
a.start_location().name):"undef"==e&&!getParameterByName(b,"from")&&(a.searchStart_visible(!0),a.start_location({name:""}),mainVM.fromVM.searchVM.saved_name(""),$("#searchFieldGoogle").val(""),$("#searchFieldGoogleIE8").val(""),mainVM.fromVM.onoff("off"),mainVM.storageObject.StartDestinationName=""),a.gettingAddress=!1,c.resolve();return c.promise()}}
function searchFieldGoogle_keyup(a,b){clearAutocomplete=!1;13==b.keyCode?mainVM.fromVM.googleVM.changeSavedValue(mainVM.fromVM.googleVM.currentSelectedResult().toString()):40==b.keyCode?mainVM.fromVM.googleVM.increaseCurrentResult():38==b.keyCode?mainVM.fromVM.googleVM.decreaseCurrentResult():mainVM.fromVM.googleVM.updateAutocomplete($("#searchFieldGoogle").val())};
//@ sourceMappingURL=lj.googlemaps.min.js.map
